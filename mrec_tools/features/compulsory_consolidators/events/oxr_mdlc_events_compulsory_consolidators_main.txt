namespace = oxr_mdlc_civic_consolidators

# Create the invisible country that controls the movers
event = {
	id = oxr_mdlc_civic_consolidators.1
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				NOT = {
					any_country = {
						is_country_type = oxr_mdlc_country_consolidators_movers_controller
					}
				}
			}
			create_country = {
				name = "name_oxr_mdlc_country_consolidators_movers_controller"
				type = oxr_mdlc_country_consolidators_movers_controller
				flag = {
					icon = {
						category = "special"
						file = "caravaneer_00.dds"
					}
					background = {
						category = "backgrounds"
						file = "triangle_split.dds"
					}
					colors = {
						"green"
						"dark_green"
						"null"
						"null"
					}
				}
				effect = {
					save_global_event_target_as = oxr_mdlc_country_consolidators_movers_controller_target
				}
			}
		}
	}
	
}

# on game start, flag/create consolidator dropoff points and establish comms with invisible country 
country_event = {
	# on game start
	id = oxr_mdlc_civic_consolidators.2
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_civic = oxr_mdlc_civic_consolidators
	}

	immediate = {
		oxr_mdlc_compulsory_consolidators_game_start_effect = yes
	}
}




# when consolidator mover ship arrives at target
country_event = {
	id = oxr_mdlc_civic_consolidators.2000
	hide_window = yes
	is_triggered_only = yes
	# This = owner of fleet
	# From = fleet
	# FromFrom = planet (if any)

	trigger = {
		from = {
			any_owned_ship = { is_ship_size = oxr_mdlc_civic_consolidators_ship }
		}
	}

	immediate = {
		from.solar_system = {
			random_system_planet = {
				limit = {
					has_planet_flag = oxr_mdlc_civic_orbital_target@space_owner
				}
				save_event_target_as = oxr_mdlc_civic_consolidators_target_planet
			}
		}

		## Check what resource is being transferred over
		# energy
		if = {
			limit = {
				from = {
					is_variable_set = oxr_mdlc_consolidator_ship_resource_type_energy
				}
			}
			# add 1 energy deposit per 1 value in variable
			while = {
				count = from.oxr_mdlc_consolidator_ship_resource_type_energy
				event_target:oxr_mdlc_civic_consolidators_target_planet = {
					add_deposit = d_energy_1
					# Deposit the new amount as a variable also
					set_or_increment_variable = {
						VAR = oxr_mdlc_consolidator_total_energy_deposits
						AMOUNT = 1
					}
				}
			}
			destroy_fleet = from
		}
	}
}


# call the mover
planet_event = {
	id = oxr_mdlc_civic_consolidators.3100
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		oxr_mdlc_country_create_mover_fleet_give_instructions = {
			RESOURCE = energy
		}
	}
}


# get the fucking event widnow to show.. wtf why is not appearing?

country_event = {
	id = oxr_mdlc_civic_consolidators.3200
	title = "oxr_mdlc_civic_consolidators.3000.title"
	desc = "oxr_mdlc_civic_consolidators.3000.desc"
	picture = GFX_evt_habitable_dig_site
	is_triggered_only = yes

	trigger = {
		space_owner = {
			has_civic = oxr_mdlc_civic_consolidators
		}
	}

	option = {
		name = EXCELLENT
		default_hide_option = yes
		hidden_effect = {
			log = "finished event 3200"
		}
	}
}