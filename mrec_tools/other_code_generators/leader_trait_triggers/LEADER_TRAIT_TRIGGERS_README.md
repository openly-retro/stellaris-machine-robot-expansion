# Scripted trigger generators for adding leader traits

By Openly Retro

In the Stellaris game code there are no scripted triggers for checking whether a trait can be added to a leader. The custom GUIs in this mod let players add various traits to leaders and without scripted trigger checks, the GUI won't provide the right feedback and interactions will lead to errors.

## Scrape the trait files in the base game dir

This cleans out the build/traits_files/ folder before it runs.
It reads trait files, and splits all the traits into their own .cwz files under `build/traits_files/raw/` with subfolders for each leader class. Each file is named after the trait code it contains.

`.cwz` files are just text files, but the extension is there to clearly delineate that they are Clausewitz script format files.

`--stellaris_folder`: Path to the game folder
`--vanilla_traits_files`: Used in conjunction with `--stellaris_folder`. You can just pass the file names without the full path in this parameter
`--traits_file_path`: You can give the full path to any other traits files, whether they are in the base game or in another mod, and this can be used independently from the above two command line arguments.
`--build_folder`: where `mrec_tools/build` is located.
 
```
python mrec_tools/other_code_generators/leader_trait_triggers/split_traits_files_for_processing.py \
--stellaris_folder ~/modding/stellaris \
--vanilla_traits_files \
"00_generic_leader_traits.txt" \
"00_admiral_traits.txt" \
"00_general_traits.txt" \
"00_governor_traits.txt" \
"00_scientist_traits.txt" \
"00_starting_ruler_traits.txt" \
"100_ambassador_traits.txt" \
"100_delegate_traits.txt" \
"12_astral_planes_traits.txt" \
"14_grand_archive_traits.txt" \
--build_folder mrec_tools/build/
```

## Create sane, orderly Python objects to represent the traits

This command creates files under `build/traits_files/processed/`, with subfolders for each leader class. It creates JSON files, and `.pickle` files which are Python objects stored for retrieval later.

The Python object format is the `LeaderTrait` dataclass found in `leader_trait.py`

There is some selection logic here: some traits will not be processed if the trait names are in a known exclusion list.

The JSON files are human-readable copies of the LeaderTrait class, mainly so that a human being can go and spot-check various traits (mainly the problematic ones) to check that things are correct.

    python mrec_tools/other_code_generators/leader_trait_triggers/convert_traits_to_objs.py --build_folder mrec_tools/build/

## Iterate over the trait objects and create scripted triggers files

This command reads the `.pickle` files in `build/traits_files/processed/` and compiles a single scripted trigger file for each leader class. It places the final scripted trigger files in `mod/common/scripted_triggers/` with `40_` at the beginning of the filename to mark that it's autogenerated. The file also starts with a timestamp written in it to say when it was last rebuilt.
 
    python mrec_tools/other_code_generators/leader_trait_triggers/create_leader_triggers.py --build_folder mrec_tools/build/ --mod_folder /home/username/modding/mre_dev_version/ --multiproc


## Speeding things up

All the above commands also accept a `--multiproc` argument which will speed things up slightly by using separate processes.

You may also pass `--verbose` to any of the above commands to get extra logging messages durings runs.
