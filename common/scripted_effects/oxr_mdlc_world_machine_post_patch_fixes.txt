# Fix stuff after making significant changes to things

oxr_mdlc_country_remove_all_old_ecu_deposits = {
	# Help players clean up their Auto-Server worlds
	oxr_mdlc_country_remove_old_ecu_deposits = {
		DEPOSIT = xvcv_mdlc_d_pc_machine_ecu_naval_cap
		OFFSET = xvcv_mdlc_d_pc_machine_ecu_naval_cap_offset
	}
	oxr_mdlc_country_remove_old_ecu_deposits = {
		DEPOSIT = xvcv_mdlc_d_pc_machine_cpu_decryption
		OFFSET = xvcv_mdlc_d_pc_machine_cpu_decryption_offset
	}
	oxr_mdlc_country_remove_old_ecu_deposits = {
		DEPOSIT = xvcv_mdlc_d_pc_machine_ser_admin_cap
		OFFSET = xvcv_mdlc_d_pc_machine_ser_admin_cap_offset
	}
	oxr_mdlc_country_remove_old_ecu_deposits = {
		DEPOSIT = xvcv_mdlc_d_pc_machine_ser_crime
		OFFSET = xvcv_mdlc_d_pc_machine_ser_crime_offset
	}
	oxr_mdlc_country_remove_old_ecu_deposits = {
		DEPOSIT = xvcv_mdlc_d_pc_machine_ser_crime_alt
		OFFSET = xvcv_mdlc_d_pc_machine_ser_crime_alt_offset
	}
	oxr_mdlc_country_remove_old_ecu_deposits = {
		DEPOSIT = xvcv_mdlc_d_pc_machine_ser_encryption
		OFFSET = xvcv_mdlc_d_pc_machine_ser_encryption_offset
	}
}

oxr_mdlc_country_remove_old_ecu_deposits = {
	every_owned_planet = {
		limit = {
			is_xvcv_mdlc_pc_machine_ecu = yes
			OR = {
				has_deposit = $OFFSET$
				has_deposit = $DEPOSIT$
			}
		}

		planet = {
			print_scope_effect = yes
			# Offsets
			export_trigger_value_to_variable = {
				trigger = count_deposits
				parameters = {
					type = $OFFSET$
				}
				variable = oxr_mdlc_num_deposits_to_clear
			}
			while = {
				count = oxr_mdlc_num_deposits_to_clear
				remove_deposit = $OFFSET$
			}
			clear_variable = oxr_mdlc_num_deposits_to_clear
			# regular naval cap
			export_trigger_value_to_variable = {
				trigger = count_deposits
				parameters = {
					type = $DEPOSIT$
				}
				variable = oxr_mdlc_num_deposits_to_clear
			}
			while = {
				count = oxr_mdlc_num_deposits_to_clear
				remove_deposit = $DEPOSIT$
			}
			clear_variable = oxr_mdlc_num_deposits_to_clear
		}
	}
}

oxr_mdlc_country_restore_bio_mech_pops_from_void = {
	log = "TODO"
}

# TODO: make a mod config menu item for players to run these fixes
