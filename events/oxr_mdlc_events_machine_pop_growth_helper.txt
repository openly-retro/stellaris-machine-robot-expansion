# Events for tracking fractional growth of assembly and converting to pops
namespace = oxr_mdlc_machine_pop_helper

# Monthly check for assembly correction feature
country_event = {
	id = oxr_mdlc_machine_pop_helper.10
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_country_flag = oxr_mdlc_machine_pop_growth_helper_feature_active
	}

	immediate = {
		log = "Going into machine pop assembly helper event"
		country_event = {
			id = oxr_mdlc_machine_pop_helper.15
		}
	}
}

country_event = {
	id = oxr_mdlc_machine_pop_helper.15
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_country_flag = oxr_mdlc_machine_pop_growth_helper_feature_active
		any_owned_planet = {
			any_owned_pop_group = {
				oxr_mdlc_pop_group_has_robots = yes
			}
		}
	}

	immediate = {
		every_owned_planet = {
			limit = {
				any_owned_pop_group = {
					oxr_mdlc_pop_group_has_robots = yes
				}
			}
			planet = {
				oxr_mdlc_planet_add_pops_from_fractional_compound_pop_assembly = yes
				planet_event = {
					id = oxr_mdlc_machine_pop_helper.16
					days = 1
				}
			}
		}
	}
}

# Update planet population count and number of created pops
planet_event = {
	id = oxr_mdlc_machine_pop_helper.16
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = { has_country_flag = oxr_mdlc_machine_pop_growth_helper_feature_active }
	}
	immediate = {
		oxr_mdlc_planet_update_population_count_only = yes
	}
}

# turn it off
country_event = {
	id = oxr_mdlc_machine_pop_helper.20
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		any_owned_planet = {
			has_modifier = oxr_mdlc_country_machine_pop_growth_helper
		}
	}

	immediate = {
		every_owned_planet = {
			limit = {
				has_modifier = oxr_mdlc_country_machine_pop_growth_helper
			}
			remove_modifier = oxr_mdlc_country_machine_pop_growth_helper
		}
	}
}

# Game start
country_event = {
	id = oxr_mdlc_machine_pop_helper.100
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_country_type = default
		doesnt_have_country_flag = { FLAG = oxr_mdlc_machine_pop_growth_helper_feature_active }
	}

	immediate = {
		# Set helper flag for all empires
		set_country_flag = oxr_mdlc_machine_pop_growth_helper_feature_active
	}


}
