namespace = xvcv_mdlc_customgui

#leader making
country_event = {
	id = xvcv_mdlc_customgui.1
	title = "xvcv_mdlc_customgui.1.name"
	desc = "xvcv_mdlc_customgui.1.desc"
	is_triggered_only = yes
	diplomatic = yes

	picture_event_data = { portrait = root.ruler } #to remove "[06:59:30][portraitobject.cpp:493]: Failed to find portrait selector" error log

	immediate = {
		oxr_mdlc_leader_making_effects_on_gui_start = yes
	}
	custom_gui = xvcv_mdlc_leader_making

	option = {
		name = xvcv_mdlc_customgui.1.a
	}
}
#'xvcv_mdlc_tech_leader_making_improvement' techs effect event
country_event = {
	id = xvcv_mdlc_customgui.2
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		OR = {
			last_increased_tech = xvcv_mdlc_tech_leader_making_improvement
			last_increased_tech = xvcv_mdlc_tech_leader_making_improvement_2
		}
	}

	immediate = {
		change_variable = { which = xvcv_mdlc_leader_making_trait_points value = 1 }
		change_variable = { which = xvcv_mdlc_leader_making_trait_picks value = 1 }
	}
}
#core modifying
country_event = {
	id = xvcv_mdlc_customgui.3
	title = "xvcv_mdlc_customgui.1.name"
	desc = "xvcv_mdlc_customgui.1.desc"
	is_triggered_only = yes
	diplomatic = yes

	picture_event_data = { portrait = root.ruler }

	immediate = {
		#check the ruler's leader class every time the player opens this customgui #because it could be changed in between
		#clear the previous flag
		switch = {
			trigger = has_country_flag
			xvcv_mdlc_core_modifying_ruler_leader_class_official = { remove_country_flag = xvcv_mdlc_core_modifying_ruler_leader_class_official }
			xvcv_mdlc_core_modifying_ruler_leader_class_scientist = { remove_country_flag = xvcv_mdlc_core_modifying_ruler_leader_class_scientist }
			xvcv_mdlc_core_modifying_ruler_leader_class_commander = { remove_country_flag = xvcv_mdlc_core_modifying_ruler_leader_class_commander }
		}
		#and check the leader class again
		ruler = {
			# Start setting vars scoped to ruler
			# save_global_event_target_as = xvcv_mdlc_core_modifying_empire_ruler
			# event_target:xvcv_mdlc_core_modifying_empire_ruler = {
			# 	xvcv_mdlc_core_modifying_reset_ruler_points_picks_effect = yes
			# }
			xvcv_mdlc_core_modifying_reset_ruler_points_picks_effect = yes
			switch = {
				trigger = leader_class
				#sadly, this won't support modded leader classes
				official = { prev = { set_country_flag = xvcv_mdlc_core_modifying_ruler_leader_class_official } }
				scientist = { prev = { set_country_flag = xvcv_mdlc_core_modifying_ruler_leader_class_scientist } }
				commander = { prev = { set_country_flag = xvcv_mdlc_core_modifying_ruler_leader_class_commander } }
			}
		}
		# if = {
		# 	limit = { NOT = { has_country_flag = xvcv_mdlc_core_modifying_trait_points_set } }
		# 	set_country_flag = xvcv_mdlc_core_modifying_trait_points_set #one-time only
		# 	ruler = {
		# 		xvcv_mdlc_core_modifying_reset_ruler_points_picks_effect = yes
		# 	}
		# }
		# Below has ruler scope included in all the effects
		oxr_mdlc_core_modifying_check_existing_traits_on_gui_open_effect = yes
	}
	custom_gui = xvcv_mdlc_core_modifying

	option = {
		name = xvcv_mdlc_customgui.1.a
	}
}
#'xvcv_mdlc_tech_core_modifying_improvement' techs effect event
country_event = {
	id = xvcv_mdlc_customgui.4
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		OR = {
			last_increased_tech = xvcv_mdlc_tech_core_modifying_improvement
			last_increased_tech = xvcv_mdlc_tech_core_modifying_improvement_2
		}
	}

	immediate = {
		change_variable = { which = xvcv_mdlc_core_modifying_trait_points value = 1 }
		change_variable = { which = xvcv_mdlc_core_modifying_trait_picks value = 1 }
	}
}
#reset core modifying variables when a new ruler drone is set
country_event = {
	id = xvcv_mdlc_customgui.5
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_country_flag = xvcv_mdlc_core_modifying_trait_points_set
	}

	immediate = {
		ruler = {
			xvcv_mdlc_core_modifying_reset_ruler_points_picks_effect = yes
		}
	}
}

